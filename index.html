    async function sendDataToSpreadsheet(payload) {
        try {
            // URLSearchParamsを使ってデータをフォーマット
            const formData = new URLSearchParams();
            for (const key in payload) {
                if (Array.isArray(payload[key])) {
                    // 配列の場合はカンマ区切りの文字列に変換
                    formData.append(key, payload[key].join(','));
                } else {
                    formData.append(key, payload[key]);
                }
            }

            const response = await fetch(SPREADSHEET_APP_URL, {
                method: 'POST',
                body: formData
            });

            if (!response.ok) {
                throw new Error('通信エラーが発生しました。');
            }

            // Apps ScriptはJSONを返すため、レスポンスをJSONとしてパース
            const result = await response.json();
            if (result.status === 'success') {
                showMessage(result.message);
                clearForm();
                fetchRecords(); // データを再取得して更新
            } else {
                showMessage(result.message, true);
            }
        } catch (error) {
            console.error('Error sending data:', error);
            showMessage('データの送信中にエラーが発生しました。', true);
        }
    }
